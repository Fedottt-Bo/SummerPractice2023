var bundle;(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{selectModel:()=>m,start:()=>w});var n,r=1e-6,a="undefined"!=typeof Float32Array?Float32Array:Array;function o(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function i(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function u(e,t){var n=t[0],r=t[1],a=t[2],o=n*n+r*r+a*a;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function s(){var e=new a(16);return a!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function c(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)}),n=new a(3),a!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0);const d=(e,t,n)=>Math.min(Math.max(e,t),n),l={vert:new Float32Array([.6666666666666666,-.3333333333333333,.6666666666666666,-.07735026918962584,1,1,1,0,.24401693585629247,-.3333333333333333,-.9106836025229591,1.0773502691896257,1,0,1,0,0,1,0,.5,0,0,1,1,-.910683602522959,-.3333333333333333,.24401693585629244,-.07735026918962584,1,1,0,1,.6666666666666666,-.3333333333333333,.6666666666666666,1.0773502691896257,1,1,1,0,0,1,0,.5,0,0,1,1,.24401693585629247,-.3333333333333333,-.9106836025229591,-.07735026918962584,1,0,1,0,-.910683602522959,-.3333333333333333,.24401693585629244,1.0773502691896257,1,1,0,1,0,1,0,.5,0,0,1,1,-.910683602522959,-.3333333333333333,.24401693585629244,-.07735026918962584,1,1,0,1,.24401693585629247,-.3333333333333333,-.9106836025229591,1.0773502691896257,1,0,1,0,.6666666666666666,-.3333333333333333,.6666666666666666,.5,0,1,1,0])},p={vert:new Float32Array([-.57735026919,.57735026919,.57735026919,0,0,1,0,1,-.57735026919,-.57735026919,.57735026919,0,1,.5,.5,.5,.57735026919,.57735026919,.57735026919,1,0,1,0,0,.57735026919,.57735026919,.57735026919,1,0,1,0,0,-.57735026919,-.57735026919,.57735026919,0,1,.5,.5,.5,.57735026919,-.57735026919,.57735026919,1,1,1,1,0,.57735026919,.57735026919,.57735026919,0,0,1,0,0,.57735026919,-.57735026919,.57735026919,0,1,1,1,0,.57735026919,.57735026919,-.57735026919,1,0,.5,.5,.5,.57735026919,.57735026919,-.57735026919,1,0,.5,.5,.5,.57735026919,-.57735026919,.57735026919,0,1,1,1,0,.57735026919,-.57735026919,-.57735026919,1,1,0,1,1,.57735026919,.57735026919,-.57735026919,0,0,.5,.5,.5,.57735026919,-.57735026919,-.57735026919,0,1,0,1,1,-.57735026919,.57735026919,-.57735026919,1,0,0,0,1,-.57735026919,.57735026919,-.57735026919,1,0,0,0,1,.57735026919,-.57735026919,-.57735026919,0,1,0,1,1,-.57735026919,-.57735026919,-.57735026919,1,1,0,1,0,-.57735026919,.57735026919,-.57735026919,0,0,0,0,1,-.57735026919,-.57735026919,-.57735026919,0,1,0,1,0,-.57735026919,.57735026919,.57735026919,1,0,1,0,1,-.57735026919,.57735026919,.57735026919,1,0,1,0,1,-.57735026919,-.57735026919,-.57735026919,0,1,0,1,0,-.57735026919,-.57735026919,.57735026919,1,1,.5,.5,.5,-.57735026919,.57735026919,-.57735026919,0,0,0,0,1,-.57735026919,.57735026919,.57735026919,0,1,1,0,1,.57735026919,.57735026919,-.57735026919,1,0,.5,.5,.5,.57735026919,.57735026919,-.57735026919,1,0,.5,.5,.5,-.57735026919,.57735026919,.57735026919,0,1,1,0,1,.57735026919,.57735026919,.57735026919,1,1,1,0,0,-.57735026919,-.57735026919,.57735026919,0,0,.5,.5,.5,-.57735026919,-.57735026919,-.57735026919,0,1,0,1,0,.57735026919,-.57735026919,.57735026919,1,0,1,1,0,.57735026919,-.57735026919,.57735026919,1,0,1,1,0,-.57735026919,-.57735026919,-.57735026919,0,1,0,1,0,.57735026919,-.57735026919,-.57735026919,1,1,0,1,1])};let f,g=[],h=0;function v(e,t){if(t.vert===undefined||t.vert.length%8!=0)throw"Invalid vertex buffer";let n=t.vert.length/8,r=e.createBuffer({size:32*n,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,mappedAtCreation:!0});if(new Float32Array(r.getMappedRange()).set(t.vert),r.unmap(),t.ind===undefined)return{vert_buffer:r,count:n,draw:function(e,t){e.setPipeline(f.pipeline),e.setBindGroup(0,f.bind_groups[t]),e.setVertexBuffer(0,this.vert_buffer),e.draw(this.count,1,0,0)}};{if(t.ind.length%3!=0)throw"Invalid index buffer";n=t.ind.length/3;let a=e.createBuffer({size:12*n,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,mappedAtCreation:!0});return new Uint32Array(a.getMappedRange()).set(t.ind),a.unmap(),{vert_buffer:r,ind_buffer:a,count:n,draw:function(e,t){e.setPipeline(f.pipeline),e.setBindGroup(0,f.bind_groups[t]),e.setVertexBuffer(0,this.vert_buffer),e.setIndexBuffer(this.ind_buffer,"uint32"),e.drawIndexed(this.count,1,0,0)}}}}function b(e,t){let n=g.length;g.push(e);let r=document.createElement("option");r.value=n,r.innerHTML=t.length<30?t:t.slice(0,28)+"...",document.getElementById("models_list").appendChild(r)}function m(e){h=e}let _,y={};async function w(){_=await async function(){if(!navigator.gpu){let e="Your current browser does not support WebGPU!";throw window.self!==window.top&&(e+="\nThis page seems to be opened as embedded, which can block WebGPU access. Try to open it in separate tab."),console.log(e),alert(e),e}const e=document.getElementById("canvas-webgpu"),t=await navigator.gpu.requestAdapter(),n=await t.requestDevice(),r=e.getContext("webgpu");return r.configure({device:n,format:"bgra8unorm",alphaMode:"opaque"}),{gpu:navigator.gpu,canvas:e,adapter:t,device:n,context:r}}(),function(e){let t=e.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.FRAGMENT,texture:{viewDimension:"2d"}},{binding:2,visibility:GPUShaderStage.FRAGMENT,sampler:{type:"filtering"}}]}),n=e.createRenderPipeline({layout:e.createPipelineLayout({bindGroupLayouts:[t]}),vertex:{module:e.createShaderModule({code:"struct Uniforms {\n  ModelMatr : mat4x4<f32>,\n  VPMatr : mat4x4<f32>,\n};\n@group(0) @binding(0) var<uniform> uniforms : Uniforms;\n\nstruct in {\n  @location(0) pos : vec3<f32>,\n  @location(1) tex0 : vec2<f32>,\n  @location(2) color : vec3<f32>\n}\n\nstruct out {\n  @builtin(position) pos : vec4<f32>,\n  @location(0) tex0 : vec2<f32>,\n  @location(1) color : vec3<f32>  \n}\n\n@vertex\nfn main(input : in) -> out {\n  var output : out;\n\n  output.pos = uniforms.VPMatr * (uniforms.ModelMatr * vec4<f32>(input.pos, 1.0));\n  output.tex0 = input.tex0;\n  output.color = input.color;\n\n  return output;\n}"}),entryPoint:"main",buffers:[{arrayStride:32,attributes:[{shaderLocation:0,format:"float32x3",offset:0},{shaderLocation:1,format:"float32x2",offset:12},{shaderLocation:2,format:"float32x3",offset:20}]}]},fragment:{module:e.createShaderModule({code:"@group(0) @binding(1) var color_tex : texture_2d<f32>;\n@group(0) @binding(2) var color_sampler : sampler;\n\nstruct in {\n  @builtin(position) pos : vec4<f32>,\n  @location(0) tex0 : vec2<f32>,\n  @location(1) color : vec3<f32>\n}\n\n@fragment\nfn main(input : in) -> @location(0) vec4<f32> {\n  var color = textureSample(color_tex, color_sampler, input.tex0).rgba;\n\n  return vec4<f32>(mix(input.color, color.rgb, color.a), 1.0);\n}"}),entryPoint:"main",targets:[{format:"rgba8unorm"}]},primitive:{topology:"triangle-list",cullMode:"back"},depthStencil:{format:"depth24plus",depthWriteEnabled:!0,depthCompare:"less"}}),r=e.createBuffer({size:128,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,mappedAtCreation:!1}),a={layout:t,entries:[{binding:0,resource:{buffer:r,offset:0,size:128}},{binding:1,resource:null},{binding:2,resource:e.createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",magFilter:"linear",minFilter:"linear",mipmapFilter:"linear"})}]};f={bind_group_layout:t,pipeline:n,uniform_buffer_size:128,uniform_buffer:r,bind_group_desc:a,bind_groups:[null,null],createBindGroup:function(t,n){let r={...this.bind_group_desc};r.entries[1].resource=t,this.bind_groups[n]=e.createBindGroup(r)}},b(v(e,l),"Tetrahedron"),b(v(e,p),"Cube")}(_.device),function(e,t){t.addEventListener("mousemove",(e=>{let t={x:e.clientX-_.canvas.offsetLeft,y:e.clientY-_.canvas.offsetTop};switch(x){case 0:G.XAngle=(G.XAngle+-.01*(t.x-M.pos.x))%(2*Math.PI),G.YAngle=d(G.YAngle+.01*(t.y-M.pos.y),.5*-Math.PI,.5*Math.PI);break;case 2:let e=[-Math.cos(G.XAngle),0,Math.sin(G.XAngle)];u(e,e),i(e,e,Array(3).fill(1*(t.x-M.pos.x)*G.dist/_.canvas.width)),o(G.origin,G.origin,e),e=[-Math.sin(G.XAngle)*Math.sin(G.YAngle),Math.cos(G.YAngle),-Math.cos(G.XAngle)*Math.sin(G.YAngle)],u(e,e),i(e,e,Array(3).fill(1*(t.y-M.pos.y)*G.dist/_.canvas.height)),o(G.origin,G.origin,e)}M.pos=t,M.page_pos={x:t.x/_.canvas.width,y:t.y/_.canvas.height}})),e.oncontextmenu=e=>{e.preventDefault(),e.stopPropagation()},e.addEventListener("mousedown",(e=>{x=-1==x?e.button:-1})),t.addEventListener("mouseup",(e=>{x=-1})),e.addEventListener("wheel",(e=>{e.preventDefault(),G.dist*=1+.001*e.deltaY}),{capture:!0,passive:!1})}(_.canvas,window),function(){let e=_.device;y.depth_tex=e.createTexture({size:[_.canvas.width,_.canvas.height,1],format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT}),y.gbuffers=[e.createTexture({size:[_.canvas.width,_.canvas.height,1],format:"rgba8unorm",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),e.createTexture({size:[_.canvas.width,_.canvas.height,1],format:"rgba8unorm",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING})],y.ind=0,f.createBindGroup(y.gbuffers[1].createView(),0),f.createBindGroup(y.gbuffers[0].createView(),1),y.main_render_pass_descs=[{colorAttachments:[{view:y.gbuffers[0].createView(),clearValue:{r:.3,g:.47,b:.8,a:0},loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:y.depth_tex.createView(),depthLoadValue:1,depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}},{colorAttachments:[{view:y.gbuffers[1].createView(),clearValue:{r:.3,g:.47,b:.8,a:0},loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:y.depth_tex.createView(),depthLoadValue:1,depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}}],y.gbuffer_bind_group_layout=e.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,texture:{viewDimension:"2d"}}]}),y.gbuffer_bind_groups=[e.createBindGroup({layout:y.gbuffer_bind_group_layout,entries:[{binding:0,resource:y.gbuffers[0].createView()}]}),e.createBindGroup({layout:y.gbuffer_bind_group_layout,entries:[{binding:0,resource:y.gbuffers[1].createView()}]})],y.copy_pipeline=e.createRenderPipeline({layout:e.createPipelineLayout({bindGroupLayouts:[y.gbuffer_bind_group_layout]}),vertex:{module:e.createShaderModule({code:"@vertex\nfn main(@builtin(vertex_index) VertexIndex: u32) -> @builtin(position) vec4<f32> {\nvar pos = array<vec2<f32>, 4>(vec2<f32>(-1.0, -1.0), vec2<f32>(-1.0, 1.0), vec2<f32>(1.0, -1.0), vec2<f32>(1.0, 1.0));\nreturn vec4<f32>(pos[VertexIndex], 0.0, 1.0);\n}"}),entryPoint:"main"},fragment:{module:e.createShaderModule({code:"@group(0) @binding(0) var color_tex : texture_2d<f32>;\n\n@fragment\nfn main(@builtin(position) coord : vec4<f32>) -> @location(0) vec4<f32> {\nvar icoord = vec2<i32>(floor(coord.xy));\nvar color : vec3<f32> = textureLoad(color_tex, icoord, 0).rgb;\n\nreturn vec4<f32>(color, 1.0);\n}"}),entryPoint:"main",targets:[{format:"bgra8unorm",blend:{color:{dstFactor:"zero",operation:"add",srcFactor:"one"},alpha:{dstFactor:"zero",operation:"add",srcFactor:"one"}}}]},primitive:{topology:"triangle-strip",cullMode:"none"}}),y.copy_render_pass_desc={colorAttachments:[{clearValue:{r:0,g:0,b:0,a:0},loadOp:"clear",storeOp:"store"}]}}(),U()}var x=-1,M={pos:{},page_pos:{}},A=Date.now()/1e3,P=A,T=1,G={XAngle:0,YAngle:.3,origin:[0,0,0],dist:8,view:s(),proj:s(),vp:s()};function U(){window.requestAnimationFrame(U),function(){let e=Date.now()/1e3;A+=(e-P)*T,P=e;let t=[Math.sin(G.XAngle)*Math.cos(G.YAngle),Math.sin(G.YAngle),Math.cos(G.XAngle)*Math.cos(G.YAngle)].map(((e,t)=>G.origin[t]+e*G.dist));!function(e,t,n,a){var o,i,u,s,d,l,p,f,g,h,v=t[0],b=t[1],m=t[2],_=a[0],y=a[1],w=a[2],x=n[0],M=n[1],A=n[2];Math.abs(v-x)<r&&Math.abs(b-M)<r&&Math.abs(m-A)<r?c(e):(p=v-x,f=b-M,g=m-A,o=y*(g*=h=1/Math.hypot(p,f,g))-w*(f*=h),i=w*(p*=h)-_*g,u=_*f-y*p,(h=Math.hypot(o,i,u))?(o*=h=1/h,i*=h,u*=h):(o=0,i=0,u=0),s=f*u-g*i,d=g*o-p*u,l=p*i-f*o,(h=Math.hypot(s,d,l))?(s*=h=1/h,d*=h,l*=h):(s=0,d=0,l=0),e[0]=o,e[1]=s,e[2]=p,e[3]=0,e[4]=i,e[5]=d,e[6]=f,e[7]=0,e[8]=u,e[9]=l,e[10]=g,e[11]=0,e[12]=-(o*v+i*b+u*m),e[13]=-(s*v+d*b+l*m),e[14]=-(p*v+f*b+g*m),e[15]=1)}(G.view,t,G.origin,[0,1,0]);let n=.01*Math.max(1,_.canvas.width/_.canvas.height),a=.01*Math.max(1,_.canvas.height/_.canvas.width);!function(e,t,n,r,a,o,i){var u=1/(n-t),s=1/(a-r),c=1/-99.99;e[0]=.02*u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=.02*s,e[6]=0,e[7]=0,e[8]=(n+t)*u,e[9]=(a+r)*s,e[10]=100.01*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*c,e[15]=0}(G.proj,-n,n,-a,a),function(e,t,n){var r=t[0],a=t[1],o=t[2],i=t[3],u=t[4],s=t[5],c=t[6],d=t[7],l=t[8],p=t[9],f=t[10],g=t[11],h=t[12],v=t[13],b=t[14],m=t[15],_=n[0],y=n[1],w=n[2],x=n[3];e[0]=_*r+y*u+w*l+x*h,e[1]=_*a+y*s+w*p+x*v,e[2]=_*o+y*c+w*f+x*b,e[3]=_*i+y*d+w*g+x*m,_=n[4],y=n[5],w=n[6],x=n[7],e[4]=_*r+y*u+w*l+x*h,e[5]=_*a+y*s+w*p+x*v,e[6]=_*o+y*c+w*f+x*b,e[7]=_*i+y*d+w*g+x*m,_=n[8],y=n[9],w=n[10],x=n[11],e[8]=_*r+y*u+w*l+x*h,e[9]=_*a+y*s+w*p+x*v,e[10]=_*o+y*c+w*f+x*b,e[11]=_*i+y*d+w*g+x*m,_=n[12],y=n[13],w=n[14],x=n[15],e[12]=_*r+y*u+w*l+x*h,e[13]=_*a+y*s+w*p+x*v,e[14]=_*o+y*c+w*f+x*b,e[15]=_*i+y*d+w*g+x*m}(G.vp,G.proj,G.view);let o=new Float32Array(32);o.set(c(s()),0),o.set(G.vp,16),_.device.queue.writeBuffer(f.uniform_buffer,0,o)}(),function(){let e=_.device.createCommandEncoder();{let t=e.beginRenderPass(y.main_render_pass_descs[y.ind]);t.setScissorRect(1,1,_.canvas.width-2,_.canvas.height-2),g[h].draw(t,y.ind),t.end()}{y.copy_render_pass_desc.colorAttachments[0].view=_.context.getCurrentTexture().createView();let t=e.beginRenderPass(y.copy_render_pass_desc);t.setPipeline(y.copy_pipeline),t.setBindGroup(0,y.gbuffer_bind_groups[y.ind]),t.draw(4,1,0,0),t.end()}y.ind=(y.ind+1)%2,_.device.queue.submit([e.finish()])}()}bundle=t})();