var bundle;(()=>{"use strict";var e={d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{start:()=>b});var r,n=1e-6,o="undefined"!=typeof Float32Array?Float32Array:Array;function a(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function i(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function s(e,t){var r=t[0],n=t[1],o=t[2],a=r*r+n*n+o*o;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e}function u(){var e=new o(16);return o!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function c(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)}),r=new o(3),o!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0);const d=(e,t,r)=>Math.min(Math.max(e,t),r),l=new Float32Array([.57735026919,.57735026919,.57735026919,-.57735026919,0,1,1,0,-.57735026919,.57735026919,-.57735026919,1.57735026919,0,0,1,1,.57735026919,-.57735026919,-.57735026919,.5,1.86602540378,0,1,0,.57735026919,.57735026919,.57735026919,1.57735026919,0,1,1,0,-.57735026919,.57735026919,-.57735026919,-.57735026919,0,0,1,1,-.57735026919,-.57735026919,.57735026919,.5,1.86602540378,1,0,1,.57735026919,-.57735026919,-.57735026919,1.57735026919,1,0,1,0,-.57735026919,-.57735026919,.57735026919,-.57735026919,1,1,0,1,.57735026919,.57735026919,.57735026919,.5,-.86602540378,1,1,0,.57735026919,-.57735026919,-.57735026919,-.57735026919,1,0,1,0,-.57735026919,-.57735026919,.57735026919,1.57735026919,1,1,0,1,-.57735026919,.57735026919,-.57735026919,.5,-.86602540378,0,1,1]);let p,f,g=[],v=0,h={};async function b(){f=await async function(){if(!navigator.gpu){let e="Your current browser does not support WebGPU!";throw window.self!==window.top&&(e+="\nThis page seems to be opened as embedded, which can block WebGPU access. Try to open it in separate tab."),console.log(e),alert(e),e}const e=document.getElementById("canvas-webgpu"),t=await navigator.gpu.requestAdapter(),r=await t.requestDevice(),n=e.getContext("webgpu");return n.configure({device:r,format:"bgra8unorm",alphaMode:"opaque"}),{gpu:navigator.gpu,canvas:e,adapter:t,device:r,context:n}}(),function(e){let t=e.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.FRAGMENT,texture:{viewDimension:"2d"}},{binding:2,visibility:GPUShaderStage.FRAGMENT,sampler:{type:"filtering"}}]}),r=e.createRenderPipeline({layout:e.createPipelineLayout({bindGroupLayouts:[t]}),vertex:{module:e.createShaderModule({code:"struct Uniforms {\n  ModelMatr : mat4x4<f32>,\n  VPMatr : mat4x4<f32>,\n};\n@group(0) @binding(0) var<uniform> uniforms : Uniforms;\n\nstruct in {\n  @location(0) pos : vec3<f32>,\n  @location(1) tex0 : vec2<f32>,\n  @location(2) color : vec3<f32>\n}\n\nstruct out {\n  @builtin(position) pos : vec4<f32>,\n  @location(0) tex0 : vec2<f32>,\n  @location(1) color : vec3<f32>  \n}\n\n@vertex\nfn main(input : in) -> out {\n  var output : out;\n\n  output.pos = uniforms.VPMatr * (uniforms.ModelMatr * vec4<f32>(input.pos, 1.0));\n  output.tex0 = input.tex0;\n  output.color = input.color;\n\n  return output;\n}"}),entryPoint:"main",buffers:[{arrayStride:32,attributes:[{shaderLocation:0,format:"float32x3",offset:0},{shaderLocation:1,format:"float32x2",offset:12},{shaderLocation:2,format:"float32x3",offset:20}]}]},fragment:{module:e.createShaderModule({code:"@group(0) @binding(1) var color_tex : texture_2d<f32>;\n@group(0) @binding(2) var color_sampler : sampler;\n\nstruct in {\n  @builtin(position) pos : vec4<f32>,\n  @location(0) tex0 : vec2<f32>,\n  @location(1) color : vec3<f32>\n}\n\n@fragment\nfn main(input : in) -> @location(0) vec4<f32> {\n  var color = textureSample(color_tex, color_sampler, input.tex0).rgba;\n\n  return vec4<f32>(mix(input.color, color.rgb, color.a), 1.0);\n}"}),entryPoint:"main",targets:[{format:"rgba8unorm"}]},primitive:{topology:"triangle-list",cullMode:"none"},depthStencil:{format:"depth24plus",depthWriteEnabled:!0,depthCompare:"less"}}),n=e.createBuffer({size:128,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,mappedAtCreation:!1}),o={layout:t,entries:[{binding:0,resource:{buffer:n,offset:0,size:128}},{binding:1,resource:null},{binding:2,resource:e.createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",magFilter:"linear",minFilter:"linear",mipmapFilter:"linear"})}]};p={bind_group_layout:t,pipeline:r,uniform_buffer_size:128,uniform_buffer:n,bind_group_desc:o,bind_groups:[null,null],createBindGroup:function(t,r){let n={...this.bind_group_desc};n.entries[1].resource=t,this.bind_groups[r]=e.createBindGroup(n)}},g.push(function(e,t){if(t.length%8!=0)throw"Invalid vertices buffer size";let r=t.length/8,n=e.createBuffer({size:32*r,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,mappedAtCreation:!0});return new Float32Array(n.getMappedRange()).set(t),n.unmap(),{vert_buffer:n,count:r,draw:function(e,t){e.setPipeline(p.pipeline),e.setBindGroup(0,p.bind_groups[t]),e.setVertexBuffer(0,this.vert_buffer),e.draw(this.count,1,0,0)}}}(e,l))}(f.device),function(e,t){t.addEventListener("mousemove",(e=>{let t={x:e.clientX-f.canvas.offsetLeft,y:e.clientY-f.canvas.offsetTop};switch(m){case 0:M.XAngle=(M.XAngle+-.01*(t.x-y.pos.x))%(2*Math.PI),M.YAngle=d(M.YAngle+.01*(t.y-y.pos.y),.5*-Math.PI,.5*Math.PI);break;case 2:let e=[-Math.cos(M.XAngle),0,Math.sin(M.XAngle)];s(e,e),i(e,e,Array(3).fill(1*(t.x-y.pos.x)*M.dist/f.canvas.width)),a(M.origin,M.origin,e),e=[-Math.sin(M.XAngle)*Math.sin(M.YAngle),Math.cos(M.YAngle),-Math.cos(M.XAngle)*Math.sin(M.YAngle)],s(e,e),i(e,e,Array(3).fill(1*(t.y-y.pos.y)*M.dist/f.canvas.height)),a(M.origin,M.origin,e)}y.pos=t,y.page_pos={x:t.x/f.canvas.width,y:t.y/f.canvas.height}})),e.oncontextmenu=e=>{e.preventDefault(),e.stopPropagation()},e.addEventListener("mousedown",(e=>{m=-1==m?e.button:-1})),t.addEventListener("mouseup",(e=>{m=-1})),e.addEventListener("wheel",(e=>{e.preventDefault(),M.dist*=1+.001*e.deltaY}),{capture:!0,passive:!1})}(f.canvas,window),function(){let e=f.device;h.depth_tex=e.createTexture({size:[f.canvas.width,f.canvas.height,1],format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT}),h.gbuffers=[e.createTexture({size:[f.canvas.width,f.canvas.height,1],format:"rgba8unorm",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),e.createTexture({size:[f.canvas.width,f.canvas.height,1],format:"rgba8unorm",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING})],h.ind=0,p.createBindGroup(h.gbuffers[1].createView(),0),p.createBindGroup(h.gbuffers[0].createView(),1),h.main_render_pass_descs=[{colorAttachments:[{view:h.gbuffers[0].createView(),clearValue:{r:1,g:1,b:1,a:0},loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:h.depth_tex.createView(),depthLoadValue:1,depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}},{colorAttachments:[{view:h.gbuffers[1].createView(),clearValue:{r:1,g:1,b:1,a:0},loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:h.depth_tex.createView(),depthLoadValue:1,depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}}],h.gbuffer_bind_group_layout=e.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,texture:{viewDimension:"2d"}}]}),h.gbuffer_bind_groups=[e.createBindGroup({layout:h.gbuffer_bind_group_layout,entries:[{binding:0,resource:h.gbuffers[0].createView()}]}),e.createBindGroup({layout:h.gbuffer_bind_group_layout,entries:[{binding:0,resource:h.gbuffers[1].createView()}]})],h.copy_pipeline=e.createRenderPipeline({layout:e.createPipelineLayout({bindGroupLayouts:[h.gbuffer_bind_group_layout]}),vertex:{module:e.createShaderModule({code:"@vertex\nfn main(@builtin(vertex_index) VertexIndex: u32) -> @builtin(position) vec4<f32> {\nvar pos = array<vec2<f32>, 4>(vec2<f32>(-1.0, -1.0), vec2<f32>(-1.0, 1.0), vec2<f32>(1.0, -1.0), vec2<f32>(1.0, 1.0));\nreturn vec4<f32>(pos[VertexIndex], 0.0, 1.0);\n}"}),entryPoint:"main"},fragment:{module:e.createShaderModule({code:"@group(0) @binding(0) var color_tex : texture_2d<f32>;\n\n@fragment\nfn main(@builtin(position) coord : vec4<f32>) -> @location(0) vec4<f32> {\nvar icoord = vec2<i32>(floor(coord.xy));\nvar color : vec3<f32> = textureLoad(color_tex, icoord, 0).rgb;\n\nreturn vec4<f32>(color, 1.0);\n}"}),entryPoint:"main",targets:[{format:"bgra8unorm",blend:{color:{dstFactor:"zero",operation:"add",srcFactor:"one"},alpha:{dstFactor:"zero",operation:"add",srcFactor:"one"}}}]},primitive:{topology:"triangle-strip",cullMode:"none"}}),h.copy_render_pass_desc={colorAttachments:[{clearValue:{r:0,g:0,b:0,a:0},loadOp:"clear",storeOp:"store"}]}}(),A()}var m=-1,y={pos:{},page_pos:{}},_=Date.now()/1e3,w=_,x=1,M={XAngle:0,YAngle:.3,origin:[0,0,0],dist:8,view:u(),proj:u(),vp:u()};function A(){window.requestAnimationFrame(A),function(){let e=Date.now()/1e3;_+=(e-w)*x,w=e;let t=[Math.sin(M.XAngle)*Math.cos(M.YAngle),Math.sin(M.YAngle),Math.cos(M.XAngle)*Math.cos(M.YAngle)].map(((e,t)=>M.origin[t]+e*M.dist));!function(e,t,r,o){var a,i,s,u,d,l,p,f,g,v,h=t[0],b=t[1],m=t[2],y=o[0],_=o[1],w=o[2],x=r[0],M=r[1],A=r[2];Math.abs(h-x)<n&&Math.abs(b-M)<n&&Math.abs(m-A)<n?c(e):(p=h-x,f=b-M,g=m-A,a=_*(g*=v=1/Math.hypot(p,f,g))-w*(f*=v),i=w*(p*=v)-y*g,s=y*f-_*p,(v=Math.hypot(a,i,s))?(a*=v=1/v,i*=v,s*=v):(a=0,i=0,s=0),u=f*s-g*i,d=g*a-p*s,l=p*i-f*a,(v=Math.hypot(u,d,l))?(u*=v=1/v,d*=v,l*=v):(u=0,d=0,l=0),e[0]=a,e[1]=u,e[2]=p,e[3]=0,e[4]=i,e[5]=d,e[6]=f,e[7]=0,e[8]=s,e[9]=l,e[10]=g,e[11]=0,e[12]=-(a*h+i*b+s*m),e[13]=-(u*h+d*b+l*m),e[14]=-(p*h+f*b+g*m),e[15]=1)}(M.view,t,M.origin,[0,1,0]),function(e,t,r,n,o,a,i){var s=1/-99.9;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=100.1*s,e[11]=-1,e[12]=0,e[13]=0,e[14]=20*s,e[15]=0}(M.proj),function(e,t,r){var n=t[0],o=t[1],a=t[2],i=t[3],s=t[4],u=t[5],c=t[6],d=t[7],l=t[8],p=t[9],f=t[10],g=t[11],v=t[12],h=t[13],b=t[14],m=t[15],y=r[0],_=r[1],w=r[2],x=r[3];e[0]=y*n+_*s+w*l+x*v,e[1]=y*o+_*u+w*p+x*h,e[2]=y*a+_*c+w*f+x*b,e[3]=y*i+_*d+w*g+x*m,y=r[4],_=r[5],w=r[6],x=r[7],e[4]=y*n+_*s+w*l+x*v,e[5]=y*o+_*u+w*p+x*h,e[6]=y*a+_*c+w*f+x*b,e[7]=y*i+_*d+w*g+x*m,y=r[8],_=r[9],w=r[10],x=r[11],e[8]=y*n+_*s+w*l+x*v,e[9]=y*o+_*u+w*p+x*h,e[10]=y*a+_*c+w*f+x*b,e[11]=y*i+_*d+w*g+x*m,y=r[12],_=r[13],w=r[14],x=r[15],e[12]=y*n+_*s+w*l+x*v,e[13]=y*o+_*u+w*p+x*h,e[14]=y*a+_*c+w*f+x*b,e[15]=y*i+_*d+w*g+x*m}(M.vp,M.proj,M.view);let r=new Float32Array(32);r.set(c(u()),0),r.set(M.vp,16),f.device.queue.writeBuffer(p.uniform_buffer,0,r)}(),function(){let e=f.device.createCommandEncoder();{let t=e.beginRenderPass(h.main_render_pass_descs[h.ind]);t.setScissorRect(1,1,f.canvas.width-2,f.canvas.height-2),g[v].draw(t,h.ind),t.end()}{h.copy_render_pass_desc.colorAttachments[0].view=f.context.getCurrentTexture().createView();let t=e.beginRenderPass(h.copy_render_pass_desc);t.setPipeline(h.copy_pipeline),t.setBindGroup(0,h.gbuffer_bind_groups[h.ind]),t.draw(4,1,0,0),t.end()}h.ind=(h.ind+1)%2,f.device.queue.submit([e.finish()])}()}bundle=t})();