var bundle;(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{selectModel:()=>b,start:()=>w});var n,r=1e-6,a="undefined"!=typeof Float32Array?Float32Array:Array;function o(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function i(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function s(e,t){var n=t[0],r=t[1],a=t[2],o=n*n+r*r+a*a;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function u(){var e=new a(16);return a!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function c(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)}),n=new a(3),a!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0);const l=(e,t,n)=>Math.min(Math.max(e,t),n),d=new Float32Array([.57735026919,.57735026919,.57735026919,-.07735026918962584,0,1,1,0,-.57735026919,.57735026919,-.57735026919,1.0773502691896257,0,0,1,1,.57735026919,-.57735026919,-.57735026919,.5,1,0,1,0,.57735026919,.57735026919,.57735026919,1.0773502691896257,0,1,1,0,-.57735026919,.57735026919,-.57735026919,-.07735026918962584,0,0,1,1,-.57735026919,-.57735026919,.57735026919,.5,1,1,0,1,.57735026919,-.57735026919,-.57735026919,1.0773502691896257,1,0,1,0,-.57735026919,-.57735026919,.57735026919,-.07735026918962584,1,1,0,1,.57735026919,.57735026919,.57735026919,.5,0,1,1,0,.57735026919,-.57735026919,-.57735026919,-.07735026918962584,1,0,1,0,-.57735026919,-.57735026919,.57735026919,1.0773502691896257,1,1,0,1,-.57735026919,.57735026919,-.57735026919,.5,0,0,1,1]),p=new Float32Array([-.57735026919,.57735026919,.57735026919,0,0,1,0,1,-.57735026919,-.57735026919,.57735026919,0,1,0,0,0,.57735026919,.57735026919,.57735026919,1,0,1,0,0,.57735026919,.57735026919,.57735026919,1,0,1,0,0,-.57735026919,-.57735026919,.57735026919,0,1,0,0,0,.57735026919,-.57735026919,.57735026919,1,1,1,1,0,.57735026919,.57735026919,.57735026919,0,0,1,0,0,.57735026919,-.57735026919,.57735026919,0,1,1,1,0,.57735026919,.57735026919,-.57735026919,1,0,1,1,1,.57735026919,.57735026919,-.57735026919,1,0,1,1,1,.57735026919,-.57735026919,.57735026919,0,1,1,1,0,.57735026919,-.57735026919,-.57735026919,1,1,0,1,1,.57735026919,.57735026919,-.57735026919,0,0,1,1,1,.57735026919,-.57735026919,-.57735026919,0,1,0,1,1,-.57735026919,.57735026919,-.57735026919,1,0,0,0,1,.57735026919,-.57735026919,-.57735026919,0,1,0,1,1,-.57735026919,.57735026919,-.57735026919,1,0,0,0,1,-.57735026919,-.57735026919,-.57735026919,1,1,0,1,0,-.57735026919,-.57735026919,-.57735026919,0,0,0,1,0,-.57735026919,-.57735026919,.57735026919,0,1,0,0,0,-.57735026919,.57735026919,-.57735026919,1,0,0,0,1,-.57735026919,-.57735026919,.57735026919,0,1,0,0,0,-.57735026919,.57735026919,-.57735026919,1,0,0,0,1,-.57735026919,.57735026919,.57735026919,1,1,1,0,1,-.57735026919,.57735026919,-.57735026919,0,0,0,0,1,-.57735026919,.57735026919,.57735026919,0,1,1,0,1,.57735026919,.57735026919,-.57735026919,1,0,1,1,1,-.57735026919,.57735026919,.57735026919,0,1,1,0,1,.57735026919,.57735026919,-.57735026919,1,0,1,1,1,.57735026919,.57735026919,.57735026919,1,1,1,0,0,-.57735026919,-.57735026919,.57735026919,0,0,0,0,0,-.57735026919,-.57735026919,-.57735026919,0,1,0,1,0,.57735026919,-.57735026919,.57735026919,1,0,1,1,0,-.57735026919,-.57735026919,-.57735026919,0,1,0,1,0,.57735026919,-.57735026919,.57735026919,1,0,1,1,0,.57735026919,-.57735026919,-.57735026919,1,1,0,1,1]);let f,g=[],h=0;function v(e,t){if(t.length%8!=0)throw"Invalid vertices buffer size";let n=t.length/8,r=e.createBuffer({size:32*n,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,mappedAtCreation:!0});return new Float32Array(r.getMappedRange()).set(t),r.unmap(),{vert_buffer:r,count:n,draw:function(e,t){e.setPipeline(f.pipeline),e.setBindGroup(0,f.bind_groups[t]),e.setVertexBuffer(0,this.vert_buffer),e.draw(this.count,1,0,0)}}}function m(e,t){let n=g.length;g.push(e);let r=document.createElement("option");r.value=n,r.innerHTML=t.length<30?t:t.slice(0,28)+"...",document.getElementById("models_list").appendChild(r)}function b(e){h=e}let y,_={};async function w(){y=await async function(){if(!navigator.gpu){let e="Your current browser does not support WebGPU!";throw window.self!==window.top&&(e+="\nThis page seems to be opened as embedded, which can block WebGPU access. Try to open it in separate tab."),console.log(e),alert(e),e}const e=document.getElementById("canvas-webgpu"),t=await navigator.gpu.requestAdapter(),n=await t.requestDevice(),r=e.getContext("webgpu");return r.configure({device:n,format:"bgra8unorm",alphaMode:"opaque"}),{gpu:navigator.gpu,canvas:e,adapter:t,device:n,context:r}}(),function(e){let t=e.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.FRAGMENT,texture:{viewDimension:"2d"}},{binding:2,visibility:GPUShaderStage.FRAGMENT,sampler:{type:"filtering"}}]}),n=e.createRenderPipeline({layout:e.createPipelineLayout({bindGroupLayouts:[t]}),vertex:{module:e.createShaderModule({code:"struct Uniforms {\n  ModelMatr : mat4x4<f32>,\n  VPMatr : mat4x4<f32>,\n};\n@group(0) @binding(0) var<uniform> uniforms : Uniforms;\n\nstruct in {\n  @location(0) pos : vec3<f32>,\n  @location(1) tex0 : vec2<f32>,\n  @location(2) color : vec3<f32>\n}\n\nstruct out {\n  @builtin(position) pos : vec4<f32>,\n  @location(0) tex0 : vec2<f32>,\n  @location(1) color : vec3<f32>  \n}\n\n@vertex\nfn main(input : in) -> out {\n  var output : out;\n\n  output.pos = uniforms.VPMatr * (uniforms.ModelMatr * vec4<f32>(input.pos, 1.0));\n  output.tex0 = input.tex0;\n  output.color = input.color;\n\n  return output;\n}"}),entryPoint:"main",buffers:[{arrayStride:32,attributes:[{shaderLocation:0,format:"float32x3",offset:0},{shaderLocation:1,format:"float32x2",offset:12},{shaderLocation:2,format:"float32x3",offset:20}]}]},fragment:{module:e.createShaderModule({code:"@group(0) @binding(1) var color_tex : texture_2d<f32>;\n@group(0) @binding(2) var color_sampler : sampler;\n\nstruct in {\n  @builtin(position) pos : vec4<f32>,\n  @location(0) tex0 : vec2<f32>,\n  @location(1) color : vec3<f32>\n}\n\n@fragment\nfn main(input : in) -> @location(0) vec4<f32> {\n  var color = textureSample(color_tex, color_sampler, input.tex0).rgba;\n\n  return vec4<f32>(mix(input.color, color.rgb, color.a), 1.0);\n}"}),entryPoint:"main",targets:[{format:"rgba8unorm"}]},primitive:{topology:"triangle-list",cullMode:"none"},depthStencil:{format:"depth24plus",depthWriteEnabled:!0,depthCompare:"less"}}),r=e.createBuffer({size:128,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,mappedAtCreation:!1}),a={layout:t,entries:[{binding:0,resource:{buffer:r,offset:0,size:128}},{binding:1,resource:null},{binding:2,resource:e.createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",magFilter:"linear",minFilter:"linear",mipmapFilter:"linear"})}]};f={bind_group_layout:t,pipeline:n,uniform_buffer_size:128,uniform_buffer:r,bind_group_desc:a,bind_groups:[null,null],createBindGroup:function(t,n){let r={...this.bind_group_desc};r.entries[1].resource=t,this.bind_groups[n]=e.createBindGroup(r)}},m(v(e,d),"Tetrahedron"),m(v(e,p),"Cube")}(y.device),function(e,t){t.addEventListener("mousemove",(e=>{let t={x:e.clientX-y.canvas.offsetLeft,y:e.clientY-y.canvas.offsetTop};switch(x){case 0:G.XAngle=(G.XAngle+-.01*(t.x-M.pos.x))%(2*Math.PI),G.YAngle=l(G.YAngle+.01*(t.y-M.pos.y),.5*-Math.PI,.5*Math.PI);break;case 2:let e=[-Math.cos(G.XAngle),0,Math.sin(G.XAngle)];s(e,e),i(e,e,Array(3).fill(1*(t.x-M.pos.x)*G.dist/y.canvas.width)),o(G.origin,G.origin,e),e=[-Math.sin(G.XAngle)*Math.sin(G.YAngle),Math.cos(G.YAngle),-Math.cos(G.XAngle)*Math.sin(G.YAngle)],s(e,e),i(e,e,Array(3).fill(1*(t.y-M.pos.y)*G.dist/y.canvas.height)),o(G.origin,G.origin,e)}M.pos=t,M.page_pos={x:t.x/y.canvas.width,y:t.y/y.canvas.height}})),e.oncontextmenu=e=>{e.preventDefault(),e.stopPropagation()},e.addEventListener("mousedown",(e=>{x=-1==x?e.button:-1})),t.addEventListener("mouseup",(e=>{x=-1})),e.addEventListener("wheel",(e=>{e.preventDefault(),G.dist*=1+.001*e.deltaY}),{capture:!0,passive:!1})}(y.canvas,window),function(){let e=y.device;_.depth_tex=e.createTexture({size:[y.canvas.width,y.canvas.height,1],format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT}),_.gbuffers=[e.createTexture({size:[y.canvas.width,y.canvas.height,1],format:"rgba8unorm",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),e.createTexture({size:[y.canvas.width,y.canvas.height,1],format:"rgba8unorm",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING})],_.ind=0,f.createBindGroup(_.gbuffers[1].createView(),0),f.createBindGroup(_.gbuffers[0].createView(),1),_.main_render_pass_descs=[{colorAttachments:[{view:_.gbuffers[0].createView(),clearValue:{r:.3,g:.47,b:.8,a:0},loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:_.depth_tex.createView(),depthLoadValue:1,depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}},{colorAttachments:[{view:_.gbuffers[1].createView(),clearValue:{r:.3,g:.47,b:.8,a:0},loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:_.depth_tex.createView(),depthLoadValue:1,depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}}],_.gbuffer_bind_group_layout=e.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,texture:{viewDimension:"2d"}}]}),_.gbuffer_bind_groups=[e.createBindGroup({layout:_.gbuffer_bind_group_layout,entries:[{binding:0,resource:_.gbuffers[0].createView()}]}),e.createBindGroup({layout:_.gbuffer_bind_group_layout,entries:[{binding:0,resource:_.gbuffers[1].createView()}]})],_.copy_pipeline=e.createRenderPipeline({layout:e.createPipelineLayout({bindGroupLayouts:[_.gbuffer_bind_group_layout]}),vertex:{module:e.createShaderModule({code:"@vertex\nfn main(@builtin(vertex_index) VertexIndex: u32) -> @builtin(position) vec4<f32> {\nvar pos = array<vec2<f32>, 4>(vec2<f32>(-1.0, -1.0), vec2<f32>(-1.0, 1.0), vec2<f32>(1.0, -1.0), vec2<f32>(1.0, 1.0));\nreturn vec4<f32>(pos[VertexIndex], 0.0, 1.0);\n}"}),entryPoint:"main"},fragment:{module:e.createShaderModule({code:"@group(0) @binding(0) var color_tex : texture_2d<f32>;\n\n@fragment\nfn main(@builtin(position) coord : vec4<f32>) -> @location(0) vec4<f32> {\nvar icoord = vec2<i32>(floor(coord.xy));\nvar color : vec3<f32> = textureLoad(color_tex, icoord, 0).rgb;\n\nreturn vec4<f32>(color, 1.0);\n}"}),entryPoint:"main",targets:[{format:"bgra8unorm",blend:{color:{dstFactor:"zero",operation:"add",srcFactor:"one"},alpha:{dstFactor:"zero",operation:"add",srcFactor:"one"}}}]},primitive:{topology:"triangle-strip",cullMode:"none"}}),_.copy_render_pass_desc={colorAttachments:[{clearValue:{r:0,g:0,b:0,a:0},loadOp:"clear",storeOp:"store"}]}}(),U()}var x=-1,M={pos:{},page_pos:{}},A=Date.now()/1e3,P=A,T=1,G={XAngle:0,YAngle:.3,origin:[0,0,0],dist:8,view:u(),proj:u(),vp:u()};function U(){window.requestAnimationFrame(U),function(){let e=Date.now()/1e3;A+=(e-P)*T,P=e;let t=[Math.sin(G.XAngle)*Math.cos(G.YAngle),Math.sin(G.YAngle),Math.cos(G.XAngle)*Math.cos(G.YAngle)].map(((e,t)=>G.origin[t]+e*G.dist));!function(e,t,n,a){var o,i,s,u,l,d,p,f,g,h,v=t[0],m=t[1],b=t[2],y=a[0],_=a[1],w=a[2],x=n[0],M=n[1],A=n[2];Math.abs(v-x)<r&&Math.abs(m-M)<r&&Math.abs(b-A)<r?c(e):(p=v-x,f=m-M,g=b-A,o=_*(g*=h=1/Math.hypot(p,f,g))-w*(f*=h),i=w*(p*=h)-y*g,s=y*f-_*p,(h=Math.hypot(o,i,s))?(o*=h=1/h,i*=h,s*=h):(o=0,i=0,s=0),u=f*s-g*i,l=g*o-p*s,d=p*i-f*o,(h=Math.hypot(u,l,d))?(u*=h=1/h,l*=h,d*=h):(u=0,l=0,d=0),e[0]=o,e[1]=u,e[2]=p,e[3]=0,e[4]=i,e[5]=l,e[6]=f,e[7]=0,e[8]=s,e[9]=d,e[10]=g,e[11]=0,e[12]=-(o*v+i*m+s*b),e[13]=-(u*v+l*m+d*b),e[14]=-(p*v+f*m+g*b),e[15]=1)}(G.view,t,G.origin,[0,1,0]);let n=.01*Math.max(1,y.canvas.width/y.canvas.height),a=.01*Math.max(1,y.canvas.height/y.canvas.width);!function(e,t,n,r,a,o,i){var s=1/(n-t),u=1/(a-r),c=1/-99.99;e[0]=.02*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=.02*u,e[6]=0,e[7]=0,e[8]=(n+t)*s,e[9]=(a+r)*u,e[10]=100.01*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*c,e[15]=0}(G.proj,-n,n,-a,a),function(e,t,n){var r=t[0],a=t[1],o=t[2],i=t[3],s=t[4],u=t[5],c=t[6],l=t[7],d=t[8],p=t[9],f=t[10],g=t[11],h=t[12],v=t[13],m=t[14],b=t[15],y=n[0],_=n[1],w=n[2],x=n[3];e[0]=y*r+_*s+w*d+x*h,e[1]=y*a+_*u+w*p+x*v,e[2]=y*o+_*c+w*f+x*m,e[3]=y*i+_*l+w*g+x*b,y=n[4],_=n[5],w=n[6],x=n[7],e[4]=y*r+_*s+w*d+x*h,e[5]=y*a+_*u+w*p+x*v,e[6]=y*o+_*c+w*f+x*m,e[7]=y*i+_*l+w*g+x*b,y=n[8],_=n[9],w=n[10],x=n[11],e[8]=y*r+_*s+w*d+x*h,e[9]=y*a+_*u+w*p+x*v,e[10]=y*o+_*c+w*f+x*m,e[11]=y*i+_*l+w*g+x*b,y=n[12],_=n[13],w=n[14],x=n[15],e[12]=y*r+_*s+w*d+x*h,e[13]=y*a+_*u+w*p+x*v,e[14]=y*o+_*c+w*f+x*m,e[15]=y*i+_*l+w*g+x*b}(G.vp,G.proj,G.view);let o=new Float32Array(32);o.set(c(u()),0),o.set(G.vp,16),y.device.queue.writeBuffer(f.uniform_buffer,0,o)}(),function(){let e=y.device.createCommandEncoder();{let t=e.beginRenderPass(_.main_render_pass_descs[_.ind]);t.setScissorRect(1,1,y.canvas.width-2,y.canvas.height-2),g[h].draw(t,_.ind),t.end()}{_.copy_render_pass_desc.colorAttachments[0].view=y.context.getCurrentTexture().createView();let t=e.beginRenderPass(_.copy_render_pass_desc);t.setPipeline(_.copy_pipeline),t.setBindGroup(0,_.gbuffer_bind_groups[_.ind]),t.draw(4,1,0,0),t.end()}_.ind=(_.ind+1)%2,y.device.queue.submit([e.finish()])}()}bundle=t})();